<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>This is my customized homepage @Microsoft</title>
</head>
<body>

    <form id="SearchForm" onsubmit="search_submit();return false">
        <input id="queryString" autofocus name="queryString" type="text" maxlength="255" value="" incremental="true" size="80" style="width:60%">

        <button class="aui-button" id="search-query-submit-button" type="button" onclick="search_submit();return false;"><span class="aui-icon aui-icon-small aui-iconfont-search">Search</span></button>
        <div id="errmessage" style="color:red">
        </div>


        <div style="clear:both">
            <br>
            <input id="RadioSearchSites1" type="radio" name="RadioSearchSites" checked onchange="RadioSearchSites_OnChange(this)" accesskey="s"><label for="RadioSearchSites"><u>S</u>earch Intranet</label>

            <br>&nbsp;&nbsp;
            <input id="HostSiteOSG" name="HostSite" type="checkbox" value="OSGWiki" checked="checked" ><label for="HostSiteOSG">Search OSGWiki</label>
            <br>&nbsp;&nbsp;
            <input id="HostSiteMSW" name="HostSite" type="checkbox" value="MSW" checked="checked" ><label for="HostSiteMSW">Search MSW</label>
			            <br>&nbsp;&nbsp;
            <input id="HostSiteVSOOS" name="HostSite" type="checkbox" value="VSOOS"><label for="HostSiteVSOOS">Search VSO OS Workitem</label>
        </div>
        <br />
        <div>
            <input id="RadioSearchSites2" type="radio" name="RadioSearchSites" onchange="RadioSearchSites_OnChange(this)" accesskey="g"><label for="RadioSearchID"><u>G</u>et content by ID</label>
        </div>
    </form>
    <div>
        <h3>Common Internal Links</h3>
        &nbsp;&nbsp; Search Errors at <a href="http://errors/">http://errors/</a>
    </div>


    <script type="text/javascript">
        function search_submit() {
            errmessage.innerHTML = "";
            var firstnavigate = true;
            var radioSites = document.getElementsByName("RadioSearchSites");
            var inputString = document.getElementById("queryString").value;
            inputString = inputString.trim();
            if (radioSites[1].checked || allnumeric(inputString)||iserrorcode(inputString)) { //Get Content By ID

                if (allnumeric(inputString)) {
                    if (inputString.length == 6 || inputString.length == 5) { //Partner Universal ID
                        dst = "https://microsoft.visualstudio.com/OS/_search?type=workitem&text=partneruniversalid:" + inputString;
                        navigate_to(dst);
                    }
                    else if (inputString.length == 7 || inputString.length == 8) { //VSO Bug ID

                        dst = "https://microsoft.visualstudio.com/OS/_workitems/edit/" + inputString;
                        navigate_to(dst);
                    }
					else if (inputString.length >= 14 ) { //CSS Case, use Service Desk Link

                        dst = "https://servicedesk.microsoft.com/#/customer/cases?caseNumber=" + inputString;
                        navigate_to(dst);
                    }
					else if (iserrorcode(inputString))
					{
						dst = "http://errors/?" + inputString;
						navigate_to(dst);
					}
                }

            }
            else { //Search
                var osgwikidst = "https://osgwiki.com/index.php?search=";
                var mswdst = "https://microsoft.sharepoint.com/teams/mswhub/_layouts/15/search.aspx?q=";
				var vsoosdst = "https://microsoft.visualstudio.com/OS/_search?type=workitem&lp=dashboard-Project&filters=Projects%7BOS%7D&text="
				var errordst = "http://errors/?"
                var querystring = document.getElementById("queryString").value.trim();
                //var escapequerystring = querystring.replace(/"/g, '\\\"').replace(/\'/g, "\\'");
                escapequerystring = encodeURIComponent(querystring);
                var dst;

                if (radioSites[0].checked) {
                    dst = escapequerystring;
                    checkboxSite = document.getElementsByName("HostSite");

                    dst += encodeURIComponent(querystring);

                    if (checkboxSite[0].checked) {
                        dst = osgwikidst + escapequerystring;
                        navigate_to(dst, firstnavigate);
                        firstnavigate = false;
                    }
                    if (checkboxSite[1].checked) {
                        dst = mswdst + escapequerystring;

                        navigate_to(dst, firstnavigate);
                        firstnavigate = false;
                    }
					if (checkboxSite[2].checked){
					    dst = vsoosdst + escapequerystring;
                        navigate_to(dst, firstnavigate);
                        firstnavigate = false;
					}
				}
            }
            document.getElementById("queryString").focus;
        }
        function allnumeric(inputtxt) {
            var pattern = /^[0-9]+$/;  //All numeric
            if (inputtxt.match(pattern)) {
                return true;
            }
            else {
                return false;
            }
        }
		function iserrorcode(inputtxt) {
			var pattern = /^0x[0-9a-d]+$|^[0-9a-d]+$/i //0x+hex or hex
            return inputtxt.match(pattern);
		}
        function RadioSearchSites_OnChange(foo) {
            radioSites = document.getElementsByName("RadioSearchSites");
            checkboxSite = document.getElementsByName("HostSite");
            for (i = 0; i < checkboxSite.length; i++) {
                checkboxSite[i].disabled = !radioSites[0].checked;
            }
        }

        function navigate_to(dst_url, firstnavigator = true) {
            if (!firstnavigator) {
                window.location.href = dst_url;
                window.focus();
            }
            else {
                window.open(dst_url, "_blank");
            }

        }
    </script>


</body>
</html>